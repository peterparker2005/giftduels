syntax = "proto3";
package giftduels.duel.v1;

import "giftduels/gift/v1/gift.proto";
import "giftduels/shared/v1/common.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/peterparker2005/giftduels/packages/protobuf-go/gen/giftduels/duel/v1;duelv1";

message Duel {
  shared.v1.DuelId duel_id = 1;
  DuelParams params = 2;
  repeated DuelParticipant participants = 3;

  repeated DuelRound rounds_history = 5;
  optional shared.v1.TelegramUserId winner_telegram_user_id = 6;

  // Timing
  google.protobuf.Timestamp next_roll_deadline = 7;

  // Total stakes
  repeated DuelStake stakes = 8;
  shared.v1.TonAmount total_stake_value = 9;

  // Status and timestamps
  DuelStatus status = 10;
  google.protobuf.Timestamp created_at = 11;
  google.protobuf.Timestamp updated_at = 12;
  google.protobuf.Timestamp completed_at = 13;
}

message DuelParams {
  bool is_private = 1;
  uint32 max_players = 2; // up to 4
  uint32 max_gifts = 3; // up to 10
}

message DuelParticipant {
  shared.v1.TelegramUserId telegram_user_id = 1;
  bool is_creator = 2;
}

message DuelRound {
  int32 round_number = 1;
  repeated DuelRoll rolls = 2;
}

message DuelRoll {
  shared.v1.TelegramUserId participant_telegram_user_id = 1;
  int32 dice_value = 2; // 1â€“6
  google.protobuf.Timestamp rolled_at = 3;
  bool is_auto_rolled = 4;
}

enum DuelStatus {
  DUEL_STATUS_UNSPECIFIED = 0;
  DUEL_STATUS_WAITING_FOR_OPPONENT = 1;
  DUEL_STATUS_IN_PROGRESS = 2;
  DUEL_STATUS_COMPLETED = 3;
  DUEL_STATUS_CANCELLED = 4;
}

message DuelStake {
  shared.v1.TelegramUserId participant_telegram_user_id = 1;
  gift.v1.GiftView gift = 2;
  shared.v1.TonAmount stake_value = 3;
}
